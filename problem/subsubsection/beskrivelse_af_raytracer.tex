\subsubsection{Beskrivelse af raytracer}
[Indledning]
\paragraph{Rendering}
For at rendere et billede af lampen og dens belysning, er der lavet en funktion raytracer\_render, der modtager scenen, dvs. samlingen af alle 3D-objekter og lys, samt modellen for det kamera, som billedet skal dannes ud fra. Funktionen er vist herunder.

\begin{lstlisting}[style=Cstyle, caption=Funktionen der rendere billedet af scenen med et kameras perspektiv]
Image *raytracer_render(Scene *scene, Camera *camera) {
  int x, y;
  Image *image;
  Ray ray;

  image = new_image(camera->width, camera->height);
  
  /* For each column: */
  for(x = 0; x < camera->width; x++) {
    /* For each pixel in column: */
    for(y = 0; y < camera->height; y++) {
      /* Calculate ray */
      ray = raytracer_calculate_ray(x, y, camera);
      
      /* Trace ray and assign result to pixel */
      image->pixels[x][y] = raytracer_trace(ray, scene);
    }
    printf("%.1f\n", ((double)x + 1) / camera->width * 100);
  }

  return image;
}
\end{lstlisting}

Funktionen vist herover, danner en lysstråle for hver pixel i billedet. lysstråle sendes videre sammen med scenen til funktionen raytracer\_trace, som returnere hvilken farve den pågældende pixel på billedet skal have. Til sidst returneres så det endelige billede.

\paragraph{Tracer}
Funktionen raytracer\_trace er den funktion som starter raytraceren samt returnerer en pixelfarve hvis en ray skærer med et objekt i scenen. Funktionen er vist herunder.  

\begin{lstlisting} [style=Cstyle, caption=Funktionen raytracer\_trace]
Pixel raytracer_trace(Ray ray, Scene *scene) {
  Intersection intersection = create_intersection();
  Pixel pixel = {0, 0, 0};
  
  /* If ray intersects with scene: */
  if(raytracer_scene_intersection(ray, scene, &intersection)) {
    /* Shade pixel */
    pixel = raytracer_phong(intersection, scene);
  }
  
  return pixel;
}
\end{lstlisting}
Funktionen initialiserer en skæring med værdien -1 ved at kalde funktionen create\_intersection (linje 2), og en pixel initialiseres til at indeholde RGB-værdien for farven sort (linje 3). Der checkes efterfølgende om den pågældende ray skærer med et objekt i scenen (linje 6), hvis den gør det så tildeles der en RGB-værdi (linje 8), som returneres til sidst i funktionen. 

\paragraph{Skæring med scene}

Funktionen raytracer\_scene\_intersection tjekker om en ray skærer med et objekt.

\begin{lstlisting}[style=Cstyle, caption=Funktionen raytracer\_scene\_intersection]
int raytracer_scene_intersection(Ray ray, Scene *scene, 
                                 Intersection *intersection) {
  int i;
  Intersection temporary_intersection;

  temporary_intersection = create_intersection();

  /* For each object in scene: */
  for(i = 0; i < scene->n_objects; i++) {
    /* If ray intersects with object: */
    if(raytracer_object_intersection(ray, scene->objects[i], 
       &temporary_intersection))
      /* Reassign intersection if current intersection is closer */
      if(temporary_intersection.t < intersection->t || intersection->t == -1)
        *intersection = temporary_intersection;
  }
  return intersection->t > 0;
}
\end{lstlisting}

If-sætningen på linje 11 assigner temporary\_intersection til en intersection hvis rayen rammer et objekt. If-sætningen på linje 14 sørger for at det er den intersection der er tættest på der bliver sendt tilbage. 


\paragraph{Skæring med objekt}

\paragraph{Skæring med KD-træ}

\paragraph{Skæring med trekant}

\paragraph{Phong pixel farve}



